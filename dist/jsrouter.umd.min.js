!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n(require("route-recognizer")):"function"==typeof define&&define.amd?define("jsrouter",["route-recognizer"],n):e.jsrouter=n(e.Recognizer)}(this,function(e){"use strict";function n(e,n){this.navigate("/")}function t(){return{}}function a(e){return"/"===e.charAt(0)}function r(e){return a(e)?e:"/"+e}function i(e){return"/"!==e.slice(-1)?e+"/":e}function o(e){return i(r(e.split("#")[1]||"/"))}function h(){}function u(e){return"undefined"!=typeof e&&!e}function s(e){return e.split("?")[0]}function c(e,n){var t={};return Object.keys(e).forEach(function(n){t[n]=s(e[n])}),t}function d(e,n,t,a){var r=n.recognize(t.path);if(!r)return null;for(var i=[],o=L({},c(t),{queryParams:r.queryParams}),h=0;h<r.length;h++){var u=r[h],s=u.params,d=e[u.handler],l=d&&d[a],f=L({},o,{params:s});i.push({handler:l,args:f})}return i}function l(e){e.forEach(function(e){var n=e.handler,t=e.args;"function"==typeof n&&n(t)})}function f(e,n){if(!e)return n;var t=e[0].args,a=e.reduce(function(e,n){var t=n.args.params;return L({},e,t)},{});return L({},t,{params:a})}function v(e){if(void 0!==navigator.msMaxTouchPoints){P=window.location.href;var n=setInterval(function(){try{if(z=window.location.href,P===z)return;e.call(window,{type:"hashchange",newURL:z,oldURL:P}),P=z}catch(e){clearInterval(n)}},100)}else window.addEventListener&&window.addEventListener("hashchange",e,!1)}function p(e){var n=o(e.oldURL),t=o(e.newURL),a={lastPath:n,path:t},r=d(this.handlers,this.recognizer,a,"enter"),i=f(r,a);r?l(r):this.unrecognizedRouteHandler(n,t),this.handleAfterChange(i)}function g(e){var n=o(e.target.URL),t=d(this.handlers,this.recognizer,{path:n},"enter");t&&l(t);var a=f(t,{path:n});this.handleLoad(e,a)}function w(e){var n=this.currentPath(),t=d(this.handlers,this.recognizer,{path:n}),a=f(t,{path:n});this.handlePopState(e,a)}function y(){window.addEventListener("load",g.bind(this)),window.addEventListener("popstate",w.bind(this)),v(p.bind(this))}e="default"in e?e.default:e;var b=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},m=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),L=Object.assign||function(e){for(var n=1;n<arguments.length;n++){var t=arguments[n];for(var a in t)Object.prototype.hasOwnProperty.call(t,a)&&(e[a]=t[a])}return e},P=void 0,z=void 0,S=function(){function r(a){b(this,r);var i={unrecognizedRouteHandler:n.bind(this),handleLoad:h,handlePopState:h,navigateState:t,handleBeforeChange:h,handleAfterChange:h,persistState:function(){var e;return(e=window.history).replaceState.apply(e,arguments)}},o=L({},i,a),u=o.unrecognizedRouteHandler,s=o.handleLoad,c=o.handlePopState,d=o.navigateState,l=o.handleBeforeChange,f=o.handleAfterChange,v=o.persistState;this.recognizer=new e,this.handlers={},this.unrecognizedRouteHandler=u,this.handleLoad=s,this.handlePopState=c,this.navigateState=d,this.handleBeforeChange=l,this.handleAfterChange=f,this.persistState=v,y.call(this)}return m(r,[{key:"addHandler",value:function(e,n){this.handlers[e]=n}},{key:"map",value:function(e){this.recognizer.map(e)}},{key:"currentPath",value:function(){return o(window.location.hash.split("?")[0])}},{key:"navigate",value:function(e){var n=arguments.length<=1||void 0===arguments[1]?this.navigateState():arguments[1],t=arguments.length<=2||void 0===arguments[2]?{}:arguments[2],r=a(e)?"#"+e:"#"+this.currentPath()+e,i=window.location.hash,h={path:o(i),nextPath:o(r)},s=d(this.handlers,this.recognizer,h,"leave"),c=f(s,h),v=this.handleBeforeChange(c);u(v)||(s&&l(s),window.location.hash=r,this.persistState(n,"",r),t.trigger&&i===r&&p.call(this,{type:"hashchange",oldURL:r,newURL:r}))}},{key:"back",value:function(){window.history.back()}},{key:"forward",value:function(){window.history.forward()}},{key:"pop",value:function(){var e=this.currentPath().match(/(.+)(?:\/.+\/?)/);e&&this.navigate(e[1]+"/")}}]),r}();return S});
