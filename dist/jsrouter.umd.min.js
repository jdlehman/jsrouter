!function(n,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e(require("route-recognizer")):"function"==typeof define&&define.amd?define("jsrouter",["route-recognizer"],e):n.jsrouter=e(n.Recognizer)}(this,function(n){"use strict";function e(n,e){this.navigate("/")}function t(){return{}}function r(n){return"/"===n.charAt(0)}function a(n){return r(n)?n:"/"+n}function i(n){return"/"!==n.slice(-1)?n+"/":n}function o(n){return i(a(n.split("#")[1]||"/"))}function u(){}function h(n){return"undefined"!=typeof n&&!n}function c(n){return n.split("?")[0]}function s(n,e){var t={};return Object.keys(n).forEach(function(e){t[e]=c(n[e])}),t}function l(n,e,t,r){var a=e.recognize(t.path);if(!a)return null;for(var i=[],o=k({},s(t),{queryParams:a.queryParams}),u=0;u<a.length;u++){var h=a[u],c=h.params,l=n[h.handler],f=l&&l[r],d=k({},o,{params:c});i.push({handler:f,args:d})}return i}function f(n){n.forEach(function(n){var e=n.handler,t=n.args;"function"==typeof e&&e(t)})}function d(n,e){if(!n)return e;var t=n[0].args,r=n.reduce(function(n,e){var t=e.args.params;return k({},n,t)},{});return k({},t,{params:r})}function v(n){if(void 0!==navigator.msMaxTouchPoints){P=window.location.href;var e=setInterval(function(){try{if(S=window.location.href,P===S)return;n.call(window,{type:"hashchange",newURL:S,oldURL:P}),P=S}catch(n){clearInterval(e)}},100)}else window.addEventListener&&window.addEventListener("hashchange",n,!1)}function p(n){var e=o(n.oldURL),t=o(n.newURL),r={lastPath:e,path:t},a=l(this.handlers,this.recognizer,r,"enter"),i=d(a,r);a?f(a):this.unrecognizedRouteHandler(e,t),this.handleAfterChange(i)}function g(n){var e=o(n.target.URL),t=l(this.handlers,this.recognizer,{path:e},"enter");t&&f(t);var r=d(t,{path:e});this.handleLoad(n,r)}function w(n){var e=this.currentPath(),t=l(this.handlers,this.recognizer,{path:e}),r=d(t,{path:e});this.handlePopState(n,r)}function y(){window.addEventListener("load",g.bind(this)),window.addEventListener("popstate",w.bind(this)),v(p.bind(this))}n="default"in n?n.default:n;var m=(function(){function n(n){this.value=n}function e(e){function t(n,e){return new Promise(function(t,a){var u={key:n,arg:e,resolve:t,reject:a,next:null};o?o=o.next=u:(i=o=u,r(n,e))})}function r(t,i){try{var o=e[t](i),u=o.value;u instanceof n?Promise.resolve(u.value).then(function(n){r("next",n)},function(n){r("throw",n)}):a(o.done?"return":"normal",o.value)}catch(n){a("throw",n)}}function a(n,e){switch(n){case"return":i.resolve({value:e,done:!0});break;case"throw":i.reject(e);break;default:i.resolve({value:e,done:!1})}i=i.next,i?r(i.key,i.arg):o=null}var i,o;this._invoke=t,"function"!=typeof e.return&&(this.return=void 0)}return"function"==typeof Symbol&&Symbol.asyncIterator&&(e.prototype[Symbol.asyncIterator]=function(){return this}),e.prototype.next=function(n){return this._invoke("next",n)},e.prototype.throw=function(n){return this._invoke("throw",n)},e.prototype.return=function(n){return this._invoke("return",n)},{wrap:function(n){return function(){return new e(n.apply(this,arguments))}},await:function(e){return new n(e)}}}(),function(n,e){if(!(n instanceof e))throw new TypeError("Cannot call a class as a function")}),b=function(){function n(n,e){for(var t=0;t<e.length;t++){var r=e[t];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(n,r.key,r)}}return function(e,t,r){return t&&n(e.prototype,t),r&&n(e,r),e}}(),k=Object.assign||function(n){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(n[r]=t[r])}return n},P=void 0,S=void 0,L=function(){function a(r){m(this,a);var i={unrecognizedRouteHandler:e.bind(this),handleLoad:u,handlePopState:u,navigateState:t,handleBeforeChange:u,handleAfterChange:u,persistState:function(){var n;return(n=window.history).replaceState.apply(n,arguments)}},o=k({},i,r),h=o.unrecognizedRouteHandler,c=o.handleLoad,s=o.handlePopState,l=o.navigateState,f=o.handleBeforeChange,d=o.handleAfterChange,v=o.persistState;this.recognizer=new n,this.handlers={},this.unrecognizedRouteHandler=h,this.handleLoad=c,this.handlePopState=s,this.navigateState=l,this.handleBeforeChange=f,this.handleAfterChange=d,this.persistState=v,y.call(this)}return b(a,[{key:"addHandler",value:function(n,e){this.handlers[n]=e}},{key:"map",value:function(n){this.recognizer.map(n)}},{key:"currentPath",value:function(){return o(window.location.hash.split("?")[0])}},{key:"navigate",value:function(n){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.navigateState(),t=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=r(n)?"#"+n:"#"+this.currentPath()+n,i=window.location.hash,u={path:o(i),nextPath:o(a)},c=l(this.handlers,this.recognizer,u,"leave"),s=d(c,u),v=this.handleBeforeChange(s);h(v)||(c&&f(c),window.location.hash=a,this.persistState(e,"",a),t.trigger&&i===a&&p.call(this,{type:"hashchange",oldURL:a,newURL:a}))}},{key:"back",value:function(){window.history.back()}},{key:"forward",value:function(){window.history.forward()}},{key:"pop",value:function(){var n=this.currentPath().match(/(.*)(?:\/.+\/?)/);n&&this.navigate(n[1]+"/")}}]),a}();return L});
